import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

N = System_Params.N

#感知数据
Task_data_7 = [6765,123,177,73,1955]

#扰动
alpha_7 = [65409304011354047237186567709588712533172325026467698363593724213142926988343,
          112842395804061866533073652196090434308350830110184467533442888048301276525193,
          22167638407458087456909011333524897573126473603610239756816857648794079344169,
          44328431963488937666383030730779073358015421103939273396866799542612616315874,
          104562966334847411476092532616950370438425171227329215456075892387002477874973]

#用户7的公私钥
public_key = System_Params.public_key[6]
private_key = System_Params.private_key[6]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(62405570499090657460014279446349010646597886543481163939726377003214394223401884116253971433982306173739453527395147333904986323603545611947282983299920749821932855124578902833870565299329086338985206166373136958127587947824045562354045995920553796794826713766683274186921172104659469077906667533559794018114190119536118837734433573619824689253786489188371072372933888109690551046562406952900989038043696635222010107321549225865792348022794243318265474773341225736377542275241786219962699495846918779316087267840350959877739904355889810963059370071777228262142278761593520567603689719292955285993340902122121976242080448092525015105937444801924756741535989567165181668708380509438158901490724760664277663077929500937545127170597768569778678677419137883291331866316945589920930786646353805759516161567937558018293966087671127215698505788924567270184907868964206929321800133700620184790604998887550733248522875330840612375464642521730461373441791803325355992022425753674207488166532980802523353275635680102734010707998074660974281561698642130974729921452788645711704358681851685984431404814830497942371460573599732838785769928892184886802442812259818797860561803714571775132513232224453850890445057751738951161389958793907683546574101455294094805397465727794475856129465899172323592285037152334921582655512998129658665176657285585862464992573663590328781365516925482017145318142973875400767811374081296787699407178623464376499376137755144535139991906340316978376266163944593856639713570351040113446582163019801432882516189281412029619131709777403210634059633268325859888970971896673645007787695772729705599997817838085607822606524789111376350138964430679616485447410536978329106346149268267047642589253880580212343279735266895378035063890875714883744099787206926281236396874737397998365565495807830432721333871898555420833974525208542597283859035404160066163117006121653829155185767800932534815779283895318600629473183457417397846781597648259334848230153646329973083337721584891436507024762815763754400252139924433461668726614247494134463019708645584193732059097830894838726427513554540113226803916398774848582132947878030357449512772497423331948797415076965398581351051725638383840153745350597804809153924325405424421662112945444447287354320089452543296806333033825808604592767582594650825963035583023217609623410546756900070344272056381334876504015894367326955344339051335783138174215567388237180631586289797218620061173095452855530792184940263907240056860527098805395165797788207279421438792354050942593920386686792794842727095726331117137977573013700077437266540604688356399699052151146346705285169022793255703562598568908871752075058668405522326803599273283323726063418881173216173003937913132897493141963248849608964905576679730418143812772394441366037585275732375453751940117052797204696060736680790929978218704826318185419061932364870040438009547067220320639284787127513890407189346508793448754587468343077216263920597960320879080158459238173757344129495233847663747761837298067055902293308950188068762620814590277335573714910834806925302058362675208138752325557834456829178050600544460364354712481134801928173585907422570311074761534849726643857252158927376386623456446944201334600710458104453380569823607965597791641808452349779921744065086975892917886451635013706033167149291883075707591342584193563089923896256997162647799751849385931431981810167360594372478488856095362374710765010148712419637715213578186830874487622838029476837975239001272087141994624139160780499899581589817530013792586300319802314126175573541168037622423879534323542012138320235986846818277941824256923644353172194021255719528200494970563835336023027955953458253686410964134352443936528848297441852418957299199309274860019117860626425970066423126876917285099980260183050076661482784545891593690569504318946503342734812783185571836197)
Ra_2 = gy.mpz(173425301343897801694549470569224977482132423090930875309010676161433610853483519434443432817875181031093014516960103684647330497258165686314232075826980464180174564869914630489921666718728040589153178458458659838085533726739358604250837426584121797257159718710493156096779162584515328569558655651873914567541501811468311299370124986342730076228252498073866513595977748554048349136864313404616820213448006281801915135694915791297707766998654532777298507592980685586919026150330527200111010310873459454179893075347723701557769718848910828229507186538062134601749102904540185380548254936938419113754055747254327120862158395621662791311365129823776085382509305227311252218450414865403154908675768465556565999923356780633901916859794423248763725065096587459252830500633544128790297699884987162585314469432413151992591212837301441189046708178570248354666841218539903753400403939080147754397374814842911287063922296655274453013692534752862617036637598996918766023189681455847049159495666627515021916614661335569415431393161111084513765168766402583393288025168253490730133418248061348373678509144233516186239147100231280839268538441345203048176389705358521988154290296684270749855861739551711873873927529166340307570762048740211333554420918118173392790578901019569256888777158233114415059563916340579775950896934263509096800730534135683322471911295984215373743259798099630151360787053450524051692832224927806032385035807563944269998099471777187651825178351350576777657087241430828641712872667774406178774455135646983640568264190995626004258495911092800671828578312562823706543711492167124982123887710809578173799798750089133761894749066712065004428394817533500980886732153487384925343112037291102070443028707490578394817283880879053479482994771654455462666477870968642243052546835380115594433911182387694260402746263312415447970200135327332290465369951377010468925946660413137794845839419713835959769567268810557326650759260616239776305510058919028458836930499691960819367399546524375771639167175341872788569122151756038179829994041080144930749332570618295815929247620583442620941273992704719072888778923876289241790571246317616158394975006661240472840736953431715011870239463976046284430870656764781883096606657236883243537456547448413194183343553021117034520569851375654307677539953186447960379034340518832236514226024230712500561658597031727100205124938688137383461193166629720757866377272503998357411767026837639649374212024485392582443679909786874284155470171633921571864920775029634757322754146395476725592733593580669527960202780436366931667242467064793256948425815281776946246279107172115107897099212116210400942768201733012891292483027388554756911352335888520855088486019188025194656691793959529923859501651411308457307613614347162201030307534975731526427874389678356497917502046499850754827066578512858327328003846458776940645617228576283236602199234199307107584437222266430830967352896102573067472414282751110457785379957124151719270199903296154473307089326220172808613415446750876926411721535845978425542831303459764646464069520400467518472080640192228430297649099300183690017389491788329337764895411814878675051600575707802875182824768786578003370560364102899162464982080151108610351170573558943305836542164046097834882609944167834493050272946362495804127487147337022392251160754843797816217066310919204418071973136705118683955133546566580537179880937462099437982493207479908357637395912674173662705671656166428467798269115166310480966957538116238976572024469715992275591275333851950291053747844404487204683739917444958265161765321917693923560609855322791133224018329908634870087874531781990585118166204762967709609402642652630522083364817923791351253815517828091993073646671361447759728439955615091610390487653276393997501575722440096263005265436534009766818333688917784972429266001992909911287597623114599919)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(len(Mission)):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_7[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(len(Mission)):
        data_sum += Task_data_7[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(len(Mission)):
        perbed_data.append(Task_data_7[m] - alpha_7[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()