import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

N = System_Params.N

#感知数据
Task_data_10 = [6610,125,176,74,1950]

#扰动
alpha_10 = [55938223678457320586225977217529546577844133102439334408923560983580220520083,
          2848921631326935200510353395593829839243358619998526618662089992347765320249,
          59698045928224943307611385018635183240445175697043564943040187109900517325414,
          101453691664314943360165983077445994137973893060623835039764909777617875232048,
          58318025073374684892780175626710443450628931464012007176340940024729693377047]

#用户10的公私钥
public_key = System_Params.public_key[9]
private_key = System_Params.private_key[9]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(45377883626824753651452251581133810264347964848286585445626307260290051690168388657754049683494819352004077548639961121987929420786139057458360644739505761299161413131334681956918542495560752672814384993941395029777796010748359166738683723148598603378984873632137333314387137597070633724923504961462513759210280769766756253697899558763908390447032702219975134364845622675654969812480108030088097983342663444287478745838385958661812711604743212106669217609682771048064146985929069865421042411830796585472655062171814274253990740529703468254029512798079618690433878538646428224762098540742668762501823381991001472447951916742961925918853846073931119244512683460273133036992886474270191749953412662213800792388719124624383977703651775050083592768119686146250723189611596146381716967510711317522323779302652010703831443172538950294231065322106088608737561897142493122676467240369057618285070213519951850630047360392384132871216079810552679172520423059484168115822503354178638770479341325072624770049130362977438698691840565150440600987139336681549782789374232067334259528797860670027028991076006346291944837764971553804850566712897028430519742799749324933786134154942113133548573842323598984114423605505460381894263944604953814043104142243438698218760173590730839055459091297220310126599363082289511605590110480373270173538392029990775608063695217738687157906277592708979768969601116236617918097423392453080849978645183767551857123128678674173551087562475521495604130967745580525735519401069544105215161953037024612122877204217295095575209464941017696113406968989350284441006556956498809055069780874375394586229392587348322575149267914465850861120618324574731148090383873950030125483039145007811089112403780992202441381152286338008250058243911930791660760978616672283119416454465788851260593073055907048717891342501455887305980174895330180888484987095943554744312635749201427785737642911302198480804338352407284573573318804607577076791915532324828887102367543244176975330591475679175957386554374913931986310505508919504854161400700685218282217194056077466790301674863371163516975289881762930290996790517058666323833012094281698056131535088580283545879994422140858642938065907902487924737868400033820165894159012437339962910257833963134493494087967973416211008610545554993293532578492517664267968115067587600140270087374956636780842057273282280289630102198589062223365430813867756562576502538656573069119094060410541589978887125936657122626891594905185512199134332648827845674089159887615302437720482573527162870636324945574883804034487508801105447976745356012634654021584325660232184675827367394035808490580398437702927513124584216390257844317639572647899721656026785237814517189161570289330153927675298374314883693462101908265085569191098335158853644810411861773683410247249715390338456968584549502996023887670916984731526217290218609412506017985227983233164758244738905406354719764827875395758657086060526608144152248228574775499131183324023865167620888500044514283996872056027153543569621382285435216962896722270330447911511120540637537608068075055539586566650860868735388255637596385139379199096243939198584503412083488766178911915377759798602448684640331764600970273380391224205980604728767332339513063062161561438109549085125657215839364786471111878345476675044058022713612810463278498022477492029375934830728242867608525503528170131315633940803899840500082604142041486225829193242698509953775206764428987981380349224249868289238793201085023546148242178104145849072400338163273351415056189562162792371497920056000722091136489135195530274860757113429389602129680777130527705477242375830982273474513859070026470438458842445787027046466574281618419188039942635582775539727707674314728962522242214905267433540527366991159658153232604607893740752869979493891746436758125190683568358609662178199451040479692270829417980)
Ra_2 = gy.mpz(213571434998889392244524515785306007674169546516943172707630774874549553178926382548633692507639872522310221523075820978194222734901597013814323274383399459541745283820471853169058972493624254395778959675424725680066867545618699109659755079360936377045008740886824806512546466530523488410511579394349049903615120762356318443236928649985882547294882605482130879590392169998190796823272847242109551606095123697648267252736643976667286412691852096145900885080546688765203654247162517676836309988240841048070565793308702724145481043525881440442249847047607990526274027390476221192766848860281852778299504522251401765868517928056663058769245266661300033440419447042380632395516140083226821643967276629318372155452169409990667521476405410519802929244990752188454306462073110802656490357604727736692971875315857384307720801976001493128753856782153193402585941604247689570959492615713056872567270009972847557174046574452340134942725870656572189232250159248431929516569577614631646198486275422670313859415202412414017244964470755404314812976321528068930593619334514825633383794872682193922254219880903945121344334545629921699703739556321906793560944136337417930048166875830950012682080294335501651836592404858095966015498173255320106277928277576779983027325634073005424637940545246720192892858952233079005818733251665566268258929969630362947145384901388493115202451363657903257322699415149409811887637690117777623360937300766438719263526556237503676391551277029372281380189366472249133895583614126980231911805295947656526014973718858509435901244135150576559525157919473561034162207533281183611691158673224059253080437193516925343225623310415885852414603260512828237495539198998386286572818198070889462806214058800507321630719154029966318410081441462390882141236583667547798472687363361481323292662296023656384374636459494207693961516925185909827700271380006321996548553185117471013425225732593090263571153674942234338165540843470330071227379178664479193777165198801363995032890868681996643358111064799261305421706066177420779098888748416461377151129867345265703564808039506730221825448068115980434669805894710322581320706337832264804600650686416017269672905426774286586100728528515444460395490365702387848219128620974765213216769733652095853300488810137349578538939055085393196105837673684454338968197179270121902777316573881091200723342072572279192417701412778923520007747019144857684442926684070627740317709237274434651963802368621849525749426378750480051509641713245956431026273409798884533257697144607226732769756965750245276941801471551976878719775185376847120717285978632652585049830171268747663357224155353869800662599115763854838216521856511908808369261779175552730403913824837735093118628143607517754722683204153033740391938897198050204761490962264622238507867428900322682677245758823811407737095421116442845009434913665824294938575140788333692298605270222242783397032371330750283493249225139033643437920138638508697279448706917692170625042150518465757866807609051746830656514158518600072941453396612277558122982258147424526338504123140565457543658736029219546391835965489874073908659493230310453303272880706057271037618614484199592533327423036632910733342839108727865242165489389424383372536259843949331892072668257652159241601880252954279566596926788962757210938721781616964157208511852823303010872646153021240833051311994536933006294488238338500430039143786895161328369380676178557534083876240145663514323194664757738380032688943563714876082036848140201142784377329712983076805015271227726091473247582588472611262992375575443537029812040285573336733108439089356374031229300124992173926284360399445780822321442710175894662360413984318998326045563631627695045157781960342758368739138478659153611734899249988640277303713614049688471109156752604525120573380871380481848188573289791325527633296645548937189863569912047)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(len(Mission)):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_10[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(len(Mission)):
        data_sum += Task_data_10[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(len(Mission)):
        perbed_data.append(Task_data_10[m] - alpha_10[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()