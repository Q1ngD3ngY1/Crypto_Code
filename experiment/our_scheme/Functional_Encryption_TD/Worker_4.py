import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
N = System_Params.N

U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

USER_NUM = 5
TASK_NUM = 25

Task_data_4 = [7000,120,170,50,1500,7000,120,170,50,1500,7000,120,170,50,1500,7000,120,170,50,1500,7000,120,170,50,1500]

alpha_4 = [62312548736497453480832483456650982941473578796180777137784969230386548643384, 
           64054305960678500929777904083234938546857537972919801355215258591653013196486, 
           19835137876183337719973403408040362000981861846821393735688467352621159088332, 
           18746778741407973218597871561523148403714854963385195740040441598826397863894, 
           20201604210824322513505661740215815043165403993207115450011218751649201516349,
           
           64319489048851532324315809274443245173568580931292578187609709518888738187870, 
           620267293515310378993121861842067004658214255791393188911110141928357728612, 
           57023193989683568739739210752361669886131873467621867845039573332943843441603, 
           61027345843942352680394957511608347626515939164221885864145658716321325519482, 
           83631467916978131746624347080935479606668223724092145157878977175481292579488,
           
           22037356287626745871116693210555756919633900699463377968475849850058340857595, 
           18334091981503713155729934834883289317573282149971450923858818979598056599322, 
           49269437468813983047081226226091137550704036343955284499107912240345111631819, 
           54376632048783410629814523980574571839627098984960515857200193816661241742237, 
           49861947272056015851262483357533431094963170070307377274120593412604982589944,
           
           59570315619285524355161408054244783400615402874492318919035157314876545030340, 
           108602451419317669571952729883991649762906668358612057736500138982476378807881, 
           15717803621597238813882976860792998177866559512791183131364307211176761506277, 
           14806996796080182058714852933734629420562453438498102625470459212135803145007, 
           21680531120567186364718496668574544777053950241190992174088527362220115859853, 
           
           53029544691914849058124010578912914260743308079462334553285570880688045937245, 
           86764537489341688819291702176868549487763773098877307030064773880241424768908, 
           23782076011164775602175793990786267142160872976126844175826609624016503012585, 
           99785974651708646840724572210778256755713177707187843043600802208027713095646, 
           92568377035646159171159644180226485180861997917454332207899427138690918537658]

#用户4的公私钥
public_key = System_Params.public_key[3]
private_key = System_Params.private_key[3]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(377769294941627359247391854700795747329472647919193751066495552168306149844364493282726306893124726661142737601765973455236149813877711260349617298943504437587920717571982770082305677298715867564198418207923775049626793974563251321029209895793604029978884381569867507663054977935790250661195041690790940773834303373601427239828225869473485118909192897964269053121190062168983766002419244929588945964483279908369199869735377452651320640480156144512742943535151683559970871543156383503092978332877710939456622704334720289612410511791829703714705711161412668069366501876280161125233684111346402470560445528393717140294869477456241434629434395139248857247843023394915181323461361838807845495899162910350792757808181316202387130427949126466199947335301651403153103121996921297645491261792473814715331109692622098390795912841658579061980251803212243552076678681030815341254499502518933616641178069895008442351880613422982132977753072625169949783781737593165378061127449010553630323045668226354484973775904112105693125488410664350787271810228607758059189904884752727441426359885357380244216594567953443977885727364655050655874543914008417962816309147468474249758062533698486596037830699376935838916785613384533206726289900462342124471793504421098328908869851382566014344756980322715440478793658301405498219983647978565826351534102622136501083982303115227229966023891541548365312557222341274117599078651629337353772133256093265760567097241832272676159818193635308174769589429537774137954684424102721546550911173245159688165757685007734498188861223975302332069297565947812923564001041234845740464475027312609155116371150817483439553788779135765838121165898017251233020633257662301193107806437966785968087777956977090577651507777453529661627991486295210410060056769079777959104783595251833140716200607925646213742366063673679008577056970582324836626363112013152334165810260284571935614010832549326632267253460996510397297507462280118822418730161130649849387565906067064247729152175766764676521651534058203354046330387040916083223393110869630431445367140046530959049895879822368798658917616460375966940139968808495342905819513276325123712528396390979791963660368815289710406752383542740992554186781629925334673778773003486433465916640994662397220146096447669079809264749882367234158889712268621887568600543511934551715073397779833854588257586780020196908899360098679228919042222650521983255369266813703501765445227352799406721978893174783072311659685179680546413384988167794927676211476300735177187504732861776633655812116078463997373966585093930443876927200396178881529407414831491118742977033739627064026800428478353358951270238187280203926523205700039596045014275537773287587337216625138981004011148696469210482740857502389860714136016283022004957765221116697308986139406083421095188264651824252151501807025743289180917593063742674356610593743992052660505360651633362800186784281360273989199724485809113074474386074072590050948614615487653494071408436730912569375455609265041290048314328169520587303876451435811400021535654300217486079351129602015526137973394934306861245882837194227952497497269482621705480208174604185939581052651671827523802503732752613993271630976441772056908935564390556025457909251540001766856832284796155245048227903282222149817933394160052182117698325339779171975966685102989159791619913332574235180427680766968336777196986026117723467768840353680887047543302567705871616397466403283931259375550051065017637794433758467138569985199545838014328000203640913919218799311219757292210619149385175062531170114819142998391530921823601919712080827621706297432151137893240458671033034384296409791580572299565698657739876891839935605497488919497154870961389887907288938082223194292224777847109954625613101000083582358136821300881702942856432738902372207301301512082588988317546834621257187891606338944411215350)
Ra_2 = gy.mpz(272124632378949312098356549422050018461867807424048162287056375381074174756417453330851137874576415562316648862126213752353301190720181404349810782381110916948915621722988726148538663557206813282811724673976103087645677717973510339987345725714418611858360008604929017919266385954247609408591410931172726854740531743392535881773620688891095637838856553064559738476283789776592494149174493498850135162844473739291218647249337434509330872463202648301711393690289313100186280931024230422883783671590662812994856876703260795520224831658487880502302137445870358465607190135674792202570554393614044863879108936776624530028981052724063928515022056729569768241539993911834119560388025870029991792968918889057176920382683743718067734012283715184463980376693780732446364944455914322310373200926281060940297654940690278641501630576041752863085253935407206836272967189131558619252290819805084742322811606964720729786236547010249555323640205328632003737108397895314340991574269510135783419880512163217773427170176042821857757998922741890738353022436399721795380120805830037281087516619825684754154241219276581767175387547416179379018646978168659856627780532702941544666457497247374185186084101584632227896596281622390868579003594199241978871930439959681476143163533274224517186175916003380287326470170631121741185551725238993022852277048657381426719967420022041281335297667541367759054875012927545844617708339805383101604811524604519161041590825028662984873280746364305538136695252838038315119855690162989939299914432684674189007297380647171343827077056091208336218246421507869202680064474228862055036516487041556713694362481031110386992357768891108876218778797020702000051786526249259316381542532538353383713000345867612965301879967603673554300753150210819365557819245076764830248237060811557155144906252942298223768147111540770309508469802789197791038482747590684028243401289721323727706481130908328323881941290928847915623325371780095998470951371301448627516862742796536422724737776007806771683866714656056662144038971110926910745890752543291273616838682683482298674274565299105265259757134845597869904205422282671588729409276799434281301961169021259044103922820443506418178109445625567609766098335681161881791015191127419365636913113835589544791972310964681543290432365020249590346722623222592227564134963326799442693963097999610173025153618349527148026890500675516014364603845636831112256417809542958371535963164042240831639592631733514438201240591843316871448576377340611197151533086984844376609045962430456954407620289921976417893374539059467654782660171301240667927946229538756618364798685716765906178198570869505332049287818883704530660105768774075998043632464195475327877816462943577512983172515241731361903941810695725436386804553982306344321050236696781423598630725888384273210444614047420133119486853003770297693111232712655553434735050491981204476032138977685919050125457214805822878767475767417264324726274858782799655026476251621484146948841887063332591341629723514169607152810118564078234345420366936931649444209061674275363460385780560912889751190896470381571201980538622808130505185103976815499928143907635641827577957912802135505094896528918045356595471432961730557442852323222388329773150134116090538496953202230385472806933415712765622131500593267591864019784745542975457108704768820119967748349113613142838453903882204895253396111709420932914764324182328695993598293453155543074831943998262028776461823503979126802196182911353347011641212122076610256035930594709137043022116394511566977980092723347199828659641431932992073549461354753896170499873904602076959815350418791932864909377653685695717545260548095912377862392820288939919674835988142183606835017518971083908908052534089106736165162687470952684553696139549829336469816241886236820644821553764814071663646774896163139976857229651486216143801688948157)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(TASK_NUM):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_4[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(TASK_NUM):
        data_sum += Task_data_4[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(TASK_NUM):
        perbed_data.append(Task_data_4[m] - alpha_4[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()