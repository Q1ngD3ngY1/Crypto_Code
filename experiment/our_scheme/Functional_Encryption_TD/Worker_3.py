import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
N = System_Params.N

U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

USER_NUM = 5
TASK_NUM = 25

Task_data_3 = [10000,130,176,70,3000,10000,130,176,70,3000,10000,130,176,70,3000,10000,130,176,70,3000,10000,130,176,70,3000]

alpha_3 = [63522566125187066556456764927373909912726211284218421011246448508692892883960, 
           2409208470116330926832310305110493054977239499386296942801684715449791849710, 
           113517673626352500141239206018899500102813717310384125436766574738317857361980, 
           37375605603684302646951325006261092494073445795806255322644516033219539977589, 
           114880691687877779925881942767867221717253840071213558427380246744809174197327,
           
           84878454492724156890692473022429866562587303151891578646443325256602367495224, 
           67024982683209163298112781081260983328866515074189854734106041088856750535141, 
           67289251102924369279640193706011109182492780977246632604738600725897862219398, 
           74196539734949063251218316599835010573375781780263598725419279417497802534054, 
           103035491321492063319453715640408659864141100610171689748449197739872601794110,
           
           90468123390936450218751360341074407346719736675459673081694357179611083294349, 
           12645883548661052429366963825503463912100475287103875168310940608683743678985, 
           17298584378449003517657383131516981400781260800849789598882870708642262049827, 
           43382465159345818425240719488884371862837229205349249451686248003358123837456, 
           17184333231159541990979421720429162150860787751672433060683713089622164361599,
           
           85905751912688945868853775351961027511796643417968681044297406470778836072369, 
           19619616534082545084214763288212327890201965937902651745172989752864033122098, 
           114305034837722378806922303182706642796704007694086261734007555841314998870105, 
           8422065751024866048555214560733396657858664308813983159970831314881993019989, 
           8836390970673200634276966705240403261784075441204861842087577814133831791933,
           
           103507277130645535632340892873715688492558113369849538491885677887520815187350, 
           105903851261146464135007034839760600071766339923319447722063319628668732286486, 
           3531388289266480766159286474225379969772569353527015040202934539198940814091, 
           109244683812902017961152300713558847361321765683346399206490596089519054694994, 
           80646533880311748120991725407185450632278907506741867369289780744460131677697]
#用户3的公私钥
public_key = System_Params.public_key[2]
private_key = System_Params.private_key[2]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(3452422585561776149438580171707068315575386167937703422049887325748076160061132927579210463651500398454181498242606629959016325097847433521750829151152629319690065282131846492377706352297199919272564909268132082852145605111926031584650888454421735900786601144378411567877203374248236904867267707060989089746754828518037628583777783594695635514765128257159147075954134277902590691281302362999773583432080601141635250913472377145297667853199494062151344452817223124197606166695761323565434660571013000973957794630165251438317083116055224081852966714761419166465902334249526955915522021566772455934556328571741159749831817547334315622744915073363460169859589949977568271443639805742949306779063994524614904608147175848557191259148772840191847009092922594625987166910582173823208567048783228545141903583152436398812814142817727171655513124539845988517278780879797571423423914240030290809839963590974876363152523447810181736476883333931252906012642085345920601621289299439231607760066752791412831205127571872565908524398327308630883375844707017817016717660242953143177884848333768629406770057544209590033695546288978855797291804418550999396971394503563554340057440703821180695832912268174685600254761380939913120139687567813166846949657820858328798780011768873655437253612159818661980958448656804174906724595002283972681793811188661854525104305713495489338105903245553769532600148661576459637416434135609253119143749093986678929293884177902512044490900239581827888263082518722866384755530592497482748986976103269994885961044068737067743034226979768374559238875245575757723100806089211004650796824372429203499308835823175131667031123272001284580439582015187175331014713547236967365067379535329636183723090078132901709677060652267516957079855166382013749010145490850683588347971349965821265342294325860641539110379461670342488452117190555718442479648000541843016452754930453003272448051356616717264219789225620522408551822692321086667582445241012355135463889690685159626054952252696838780984855777975878870873836814641400424477852338849609606967707930570808453572856178802826059766996761554065376862793244299692413830979396738749411312252297230567477716778183549085648498252765266457294193371510034000411647991704599259793032936307079750396257279479908066172264144059562197032130588283191437769002618466503081643105513344768842144544386513184427879826291098376705654551945225860305914424707748198909499466688743970047769159743491981240525438039964924225806174706626780938407575403055838419761578367066996157725284961052097155240816021172635633903985667722503321335744099853088052675539181292449636663979880515218077684228707581782058144478804526056261124541829243055205937810483078297984889901911387155754165018794129801680862628453257469960264490441065039919038109265052147288687224352474599528677611756875719288892540440061312086998516472012330104324291840792244442371949752812076652265991110612925213989498245209433692144330463175653713235750401030597166271022897282932216691575708296159242244250301151606066964937277197604965188402736043776661442345580161198254782961794364171500430772080138382900742735060197335320597083623302084275489088088981067779041607386990239529467863928895804731013512593683965560016669620420508748754313346485342471118764845547924334629470839471663893898043777127498141873215668044619624626240332839246900676311463663044836561879068642583559702921799837063074119636190694340129704549364890001542792321432267760933803476030337170334529928509018012033024275115445057615730818719447526907527043820252146034054289174134395605259817086725921804408524134525961827973247431262604477759710061141120167723810246566816784714650050603983659715132697382221550179288093129448639462933312952170235670338252431573807690971315854973545988134296006667088307047129622674040955264455493822609660153471211786412293)
Ra_2 = gy.mpz(277802566569659899199743003630371886743442445091865099817367238803623371163289553772788576993032491271480499706397378678721501076051002784177619256722502706382894508574870040560853245724203436393090013688657039792750697661034490783494795573117479364612090405148999991539573634453393802726887635219104714293411563165563020192863739530896812174099579330144743995874805887887877992855026387784899807259306276084376101632465558759599343067506139287258930871330287172370251878417964743923810944596862031084378216078197575337576811713515179666146148802140101276308500788962465788145308010409620487046852379908515400832480090841827676080697865804000237559579909622294875121970406841457253299526078792140078676862124874580506927762542447156349174347523672188717917612304353779300889695652483347143160578780916896294532898298120155693632221750207542014528340303799497672545401050214785797899946812352555316981438499510840867672518236928682082408867495993363737416044852601870304466961053698538056762185723832781826710008157460994851674103514705945352626692095056318343641163931800410227818933491389385399930769692070962356404783413611829781044805060889870110286057384007487772926116248980882150283516747554808170045936995409359597864607545749017429865306269682078822418623357708281555933208774216168321922779526398278209983954311094137789086540391480912318647442099275349085749986287578268107321882866098199161189321807556924066267536572769906206247347981175280089018686625977863304075624319479613575879238529983314552372313352318939914623312336767531776430597674939107842551900771001297445833963043116547199751681030863381552083458694237617515630216843153214904025400775433723667745895348666548717054653607666478879670544953143307679229539581296509921472072532238370822386069102063412604570289059682394464176236020719473873748708785373737379860135576057371898709878022429194538486667969105529165411145621734806611701006523698554886888767708604782409440748963058072679475924156633565622128188675327236223825691539189066592094868352229134365298491054780028282248550677804238105442400662671902528841736626971613977137325536782954134657623018936895094970078500719060167987839340622925574603432919916924400044210569176850502081614404420574684915940953343347019526522705647039202171815043504139970309714166120224228233658704288952814927803762658514441590679103203203227035932508435246242442919151843896600582547963043973124904670759455827034792771390337872802083202402815948052235141972942328904556233466494356454787040969551620821722898725756410943700064918413731517924355868470148258965570323759657252342827039528630980251342930748866537341682369472627369682858890976512545823337291303703927891923661728127994479017910590639977778364668826706931002510059913995403438175527988312078447796896730217996003206776135140263610638520080917170843557479901918109108122754165937987759273585581727505551523225640616664661681622122593416855607981809387509951020602213182254604129661224673322138435203357703964366874346449077751299086945981766000319387464663403284104714738880157041033747518681541706814637927773765683393740333236164361226660494832838323640952039958320830612829773415288565585849369309263305347505624886667287750320536064849769450396520911697613981382141344282880366362352136101245943994308537530953701460512711033273085389459026548387554597151097133911755940942848533240935373388457419820396661055965722279243965747329447665991317425610827320312980193453672515805135086901123764975358141848207862353622169079463582718281701197686840548599776945575232144430546150082548140504742954943264339725935989230887257399339982601645100261356404930053034587880107206362101676779477336568656310978041071025712511508139921227879789339170493133883921116766400380606038377146798647109696811988869283063694260241196391802313840132901378659)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(TASK_NUM):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_3[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(TASK_NUM):
        data_sum += Task_data_3[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(TASK_NUM):
        perbed_data.append(Task_data_3[m] - alpha_3[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()