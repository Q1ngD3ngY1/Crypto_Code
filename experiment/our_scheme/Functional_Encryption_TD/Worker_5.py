import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
N = System_Params.N

U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

USER_NUM = 5
TASK_NUM = 25

Task_data_5 = [7190,127,190,75,1500,7190,127,190,75,1500,7190,127,190,75,1500,7190,127,190,75,1500,7190,127,190,75,1500]

alpha_5 = [29570929772973349417968750706070689975526920770033625399115048062619150992298, 
           96784599580189734353569887609390758722769477223581924642005694087560629449912, 
           21077299056370535147157222341468262036561137739159405038991391911128092007265, 
           69473945125418599488020607054720093749407458904586736888715945536961994897683, 
           18773976058461958245909423671154077797152685511502714027189255601719507001640,

           112265350327667086632380828459338610940626952394519975816205523170426940301221, 
           77803259844244377303300044348458411991845686083987620490483659183817018640871, 
           24645123421264148108663584292455374553896187467281258803011903031732951539800, 
           96249396594326154538609843166223288674525681265613042993829035820462274065873, 
           13641164048590688726734553679618933956098673128725974689572890788785899026227, 

           109231735584107987188923530943702254175415289578618550755335291484270100963368, 
           20588343665560642564581195412616014031907293933355100758715414611883462641969, 
           20521122663434957567991681147800704187752729568132117053456637904460773645002, 
           62468329757496509111280450036672510906602718638486390633937536932438197979523, 
           51448316374913558982100130149747296397559570961442790387524689919729616543045, 

           624647904842078174810106640583240736192976270186107800573619575203344751567, 
           58897475872112413428993391419928368160022660146520082240028140408498044117068, 
           115555873792869539907133670369201900730144823147009335351833001238284493146459, 
           19273794077020196281413933299689680098970565704088413774174798948095092028838, 
           31360016255940157391110058219506108276482320611913146486151374127144610945403, 

           31328036475983122519042329271147709268087343980682625161263317021837605825370, 
           28797444336888695224762439752444085477976508596765916191942265006134104652672, 
           16038810261442278228267248924704644020737335911978411501106645664337795646872, 
           94438980322764661753211195484091035135097567014217765514687464369022793039177, 
           19688935691509082282226516854812935938009654244821277242053025024618421003712]

#用户5的公私钥
public_key = System_Params.public_key[4]
private_key = System_Params.private_key[4]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(259547865834851972091382002968038228950773402130577835577393889579456341418570365070740924924185041600156957995397105785124344244019822318246694431223146705823180820652089647767605214291971407438609404794990881923993371410579498071251281879194977393905604555784716422808521979517843174234645502939777988589826904683863479096548060571530317470960917547398070156503949877433554122726462935178569066017482247621492451720224483801318325147385648231156102095032738975303194933080848778834664809377963653579509453306432073339225350381427709182755112616270667813976301770824118304625351794814809615957621819806997284258644404129947289914728402775426419311394809811506339644899483191813499971246629778090274459368757610270589782786762390709944762207763678143038853850844226277516722401295807863783166404334997008192681205634271153828197408321568725729720803610714595540719832512893199673240289362660291719402855782577044396053272270378115498862876724349842708179502645557221991029900454202762033378768214710586735097305896774879688978284838995703401187558236439179134759566844494922290305924143448830697251502937250657827032041400802254468017820916508880624225977594663471315132458273844596436647445818795902792018622756559015383690663107974928692760682166329930781457436451855238181923941211045489083090415061487741826131031693481068766688058181566028818224334720314798533654795795647914533096998248456048116221598566495841173193352510044679501706758072314804229490239755946670057319174379867010055249879688152385472459632315848537032995160536328798758216141418479598359914381914903531070681222046324086620402110200449137782767901838921708303230032022830324335933850678708765606756887380626381678688014670162852900386154172759473395138492255852428106457021924304055539941184284043781756157852976221195597246265293214323599652074420759700983185920528094914250449323394053523387879722002657812428457768333379707569930338117746638851515201344169480688016193128204502270471524434925020422056562251116296649452896559791215021114419546193649982912578676714247385452168964967056092325788057750862375155340598505669715646777337016496120098011074781456102594050139354781785912317960092091323907375011193077763009222691315472943264122517637967441501184682006612908354509853566005078349002566907626443101231601677936044205144823679671990489418841399978019252235488225064523042407905874991186304732810976885588920213890778615051020675228561059539396217045590090793391923344565817082032763288156631365987150586457310068874831558574049137050579370571795538561430739849492957823227577945844862310427833201555592515206687083995940712672072875897059037382424163470373623600340911393964875922347904101777846476601362786392614574855193656104372170775109433679600647519923792367149117495272090919733404486585375833859194930288034028280672325333416854886212990948038645220570564906986766535457213648754818134476421956955042689227774995831490343498267989354387984299160063526552366110473647052974835449040283689421809277301360788083304126526696424184558801400641672957262028934506273422417890900664283073630309490061621120822935958808034231786283867674383792558412112642726777646931591357695660127472224121662574463670511478216760998619583786832826828076822616109566178105268648111840471681686846721341272564687733887035207802162639184616918635228001286831464542807131550701388099220089332013213555914594482633244432292224176207775395199475146539735010045938710520388949494306894710912227595545424299138765597462084090737197027014271565096114563728324636811872202097737730041032700860701938793863934588453894304867143690597939584090389137418523062878286652470328363593999989191388158010295143704468454658321135084067277528078037577406316769070569182016377027080709569966368792607528867389227852234170648856176274324561147347270818386041957752595)
Ra_2 = gy.mpz(213987681054896599563113984928768146929478952077239601632068804546279846929512817018310301184334619337824664508267993252903023414584816128834331910639055673603404960072749393802694356428436713828041923048582574880082079095000451700102524856215948499976370691330261970572577094010552538677173135728892725686340464428904172356197812424100254240200575206811158165922525638090192736162172952403186742003730666460986703726814519992156404111757313140658861966533853401321335178678234288220841082903182926356905395297327101093402271253755973806757988054435857549374719873456490699339693420882973840853205762895156127858954551080717752914236248421191220154815024023543662844120644849479018529312711272945369133817222307979106717715796787741035836395967452903376801326767136251354183662726532521487701964301647539182150722345530929460070193200509874456312836386388839832955481108766668745277162151842273604427634613570616713613774363042298690331161336186911965617606538331815466349745081466805978599353048476885907530747144231475686044430320143093988039301766976800567399108519028173184963805100762458499228827921571410148055810395954818194036286241651113608902179473134242502628424926589760502984933771290516495655046290941090336555905347906499395147738737675532515725142212411256549943849241708940002016082465063532028106167241763280095986903852148649148329853932650328976175381623171630486800950336298410559089416797535708370977732703443623488802658026980878684793415258612197276998193400253347709235217981015567411890706974508203458606724229200276263561982428847177161944247214978022900431983914511863678670867383199266501535072527340130935067096273646104626595710684045400589060280940127132833937866146428222765134923872245285323923675739145210550139641075284787442123690280631283916663138299507118342644672424025907780959514447042368076989670864463542443741772436504751191533611739095494710965294287342455036982956205124446527993635046632990404221303958133718816748745175016579506975298369832951906367346321160211164208409696099379373099616512503283325913536954318288170111411552851912865537965383242246160170324104235781198477758358841976153925588745326028827817512336537870821780733769909081865438367471280886420387712115126789969010000233933000970891451927179037911612021029773288700284911416451675659751786756563265770091859730761556418114822745920678532749169750232953374798083282450164634087371330132862212067361398922523316439993721952951463424710235860944592403076775426951441678101122456216264950746784537096859713980696002633577249564746252116847905228670631448031140137867277358326457353946806652662518636055220161599140041342937649801214187923223913279233042111624343726784070045561889509114659720889906711878426843301213043952352024144122104622978773077561470909263705038252268269100679659216788573172707041211985892622303481989991596276630312726110521373041480921882865790740082710052684657654164332219513176980688136405401055707650101588366211213698649374061804735917949825968109975723464662752539033713690339150776679106504792573235050935512421226099260293713758673435115648137127105179772577879529133885264958408591666383855890582915220665480464054964962461590653904399415300628408465956740302248672179272525815945075884985370739754318240646353328251846423479060817263135981805470583013738599727071428611497176716767065251376999904012529375851378986284899059702219122984001409960083288874279859752277321163122884670386517398718895111597223832142567330639508743968705316962028304636835967560106443171284129221683643219943995152641105941934961902545017520545099763551855063576520656640905405022922413483136888822708732626208186824287611559601824043307501496273184604085363610736380778376925640719378279477607641448556683232940633921160644022445456834767489618098861695876120777649542122267959718695515385)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(TASK_NUM):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_5[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(TASK_NUM):
        data_sum += Task_data_5[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(TASK_NUM):
        perbed_data.append(Task_data_5[m] - alpha_5[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()