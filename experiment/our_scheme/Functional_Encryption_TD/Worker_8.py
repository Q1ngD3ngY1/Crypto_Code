import gmpy2 as gy
import System_Params
import time


'''-----------------------------------数据参数部分-----------------------------------'''
U_ID = [1,2,3,4,5]
Mission = [1,2,3,4,5]

N = System_Params.N

#感知数据
Task_data_8 = [7000,120,188,70,1899]

#扰动
alpha_8 = [82311233059362826292536458877051790059863656700534136836280522182928647995503,
          85570166055603503963241492763829970922073310076502773750400818987063390197163,
          50581398802476747285065499181964945506412184399799615686276017128518175627321,
          40134484064243320410604578954571590973131345465333677911899673185710823132668,
          104545717417648121169975128314758727909304342625913470898014862589977113121163]

#用户8的公私钥
public_key = System_Params.public_key[7]
private_key = System_Params.private_key[7]

#用于零知识证明的两个随机数
Ra_1 = gy.mpz(232052249960783676028102475936721943724675706908279587986332769233889178181333772253425240284644081355914720638846525077282312585602779324813519533235346141761306102904896163313970527698183153417719444281226345897912678019718100951057967420816132929454622441793425274293378872664398681779193415931574715656706663911766167356884640969009379325225771227902947489386626849745704122602803891013674100902617172805906142134002199439702444593375650844911743624413504305516484403150909854605625756613647928402076213985237667353236091972002262386123470992455389727886721690763901491190715028491740536005497514068156961228196251958270301787578087868585397792933451403524825402646740023319935867336338480950501262574357629049268824077647643946519003972510214255693558529746874937661242049781142175465819668055988727408783047293668815681466077919202059377066465534660106004425238916416245114948899096973729857521321414794109180192040056142511398952725009393113044966513303448928388624695038100763781859511882189796817004226966870370238780357902888141242823699368130106855317683727443355246213972383440160548570214546981067990963940033219545944667028265634618633137293257028621721780527455080691531206289043128597090159209915786787309725055417892717201691486922495554083063726331795007026083063527118194214683119748233357987827910976976749579329905212005802956103618064773507205311615390577858583532460828852667364500648765245581594614538811990402649766533442641445466173719796864788341394032325466589420619194051745569238664190617200963333215137624511100952841158047389270020285962944990349943144893106578733419574403280964314857620500814082582261028771411822587997585941762468686533100348117481411513722974136090559868581711181631128642912319077774777799309180082435134579787909676653877445625641638382229512374478335703255386299254388295520633327962491202019846821663794775429515179209118780129948383554784707229419874082561516979964734384401383509035804293856657602445993654863875108243238795385387173935624784032611574407939676675552521971800218778887858509173555207216759789420422035526854645387954582080626693191770416223246435624276276207282025262892898981022194681038029828053267340035579573829735595808936595371773893795560313175407000648409458212339448816517973032433845986951020150253812046863072620078258875957650741001847470482871914737917624643374660712236413858495211852075873067529392916115366159154148467967061981141472653063047975114255609657952713052499567341205506379802203011923479381865434397904498842394156613139973053979600145488509241846872932888391111344171796082946608308859032224494270982341164166859905488839002033737218611148541268394191566688196878652953938639702639324558811279214096773919313933798229280039255896078515590813202322500798966232296052015597928239808992365172932807324924941105677024643434403216885037864320645402849493712686881526077400353059896582240642647154229557715040436687624342844646093554214042172251055579013515136447990506681666288928498170650362497830038807713336675634111964608774935037572041472755321708685981264449081995805205255614762451071112744757436723238301211251711987439039148324661003169076718446200510493090028912934114532436391897728701824445537153959654582494199108591880811195792378159460331302033052058812114259880268496684647930445473792373796214688376044386223375153813010159135391326717695097352594435617556548681622245155724712088989207505237400336059837565460345844434580662208040307142907788398696679280068283696283459212192876063304841476163391288610289987837174934922505200175955098741889755283999962500503639729778388072196805703572381826457824661330387508444144257390845198881435116880325177313487553051143265128531186615522518097311753312896688973400938499615536397395564771142129787849372433225383619804850833864535586068292527728952347080682)
Ra_2 = gy.mpz(179019022601413469566807067084525461792695166804543679581391676702105683050582954206843506989715436766832995246741032184060851079555537871421134886230815909657551003947292591283652508997678258671485628649590438576320247424381413653346463132787725871126486881367637770661832174652163802201425787022816624193726482275651706999213514488322569759403677524039529471414708582229455911241583708536739620885688952141898674096716226591928122719595568283816888705376788911605164773281119564350575518495213776470227060223345806750746007065242207214636116751333127833901913501509249476450968355589534375562486310413195745577868192987241029407644022038372138922922900746693970021259760221020073747660080489175707152331509699921301343418423497648881099775235535117171990905425890007034122190577726009903575955587288343811842705300071248007738340421362740437404734476096491500298417427871966188720009102512671588331037610006944607602952126421269567002566612432429513018696669303051084744092783925473785932315728639057996191520283291596553762471670260800527999063198378933001054389020476377125751503768214756799688528690711906705696795736311688204706181649608089978967225117325584655483081709988389754834550243352689512914485595306486476835548735220619629266829159032824402174239188665087599974498915503881990414589340606634195643767051375639152294051280794696161236641149806366171776451351740122353072953950459518694089082431282145707789884575613620035874910714582693920705950553888603517538441221585157225467187991177967937117723859531244427005350877726679840320969897871796629076322955198424781558644710776647763739893090475536123329757152499687636001033413124040219520119784879028779188271045387454045550264399295524320773982222710643026506346293511528513407926853853366924777639116173123331486602283976836732019701356374073433140249884520135347279535378182742304701299970555331872119198123202470686407382056297258770448561081010198207292698475680423947313495745654128839673127430300546182401158977482267471634555302753806972283071189835425983176557921425594695858985167092173500369424316190301857145541975961267704829052804989037392182247979769823947212386114529209623708351292346709893876519048972905518236274291685799275099591298584731532214230195907391859250459691208010490093730231813802562221790865726530094147840845935989775658232978079663985864580993147579701516869552180546014405772869750765334713949206825545171602646250040776353981390627511998173840813842157626714147731714662037172344935358172558764694048569584949610215482771297607198273362029943004606889102685534829687325224752594541056999654969050868522542657898057618116546387178820922767835431841690441854326618845489797906422408239876484969007924369810038665494397251581782927310986582468529168892542301772041721408254947175653441296737461261975113382726047249706986772115624454933812748978062402288210928008887227455239415654382312523891078532446671765400500937315802226231629531998814854179350279022780350618851566226078578571179976882722281185038454142713564966084106512714473482472409907157021945946595747572017632109250553242199660776381592407311259352008241183059421747508222808423448753941012905851920134785312086177103453401939136610171305155887501072699914576669160203241062361340290560969392013723813106120367746686876053899365677029969670382810342167760350395973146169113462974448615090532350167895999308831308335873761442118318311474339505756807890872733431983320654128889242719978296798305357184935900862741359027689689117769882910070800229675958303374815088057868828965641693631580032486022787055303384993886548109587485247689027721903143103892923763274358332175205748360448357126676240202414717106237452529772538023502416193633153817190428017343875185393860035062003888999185918024264953467691143351912789287698746525598686277849131069507499026)














'''-----------------------------------函数部分-----------------------------------'''

#加密感知数据
def FE_Encrypt_data():
    rm = []
    ct_1 = []
    ct_2 = []
    for m in range(len(Mission)):
        r,tmp1,tmp2 = System_Params.FE_Encrypt(Task_data_8[m],public_key)
        rm.append(r)
        ct_1.append(tmp1)
        ct_2.append(tmp2)
    return rm,ct_1,ct_2

#计算零知识证明
def ZKP_generate(rm):
    V_3 = (gy.powmod((1 + N),Ra_1,N**2) * gy.powmod(public_key,Ra_2,N**2)) % N**2
    data_sum = 0
    rm_sum = 0
    for m in range(len(Mission)):
        data_sum += Task_data_8[m]
        rm_sum += rm[m]
    h1 = (gy.powmod((1 + N),data_sum,N**2) * gy.powmod(public_key,rm_sum,N**2)) % N**2
    s = str(h1) + str(V_3)
    e = System_Params.hash_to_group(s,N)
    V_1 = e * data_sum + Ra_1
    V_2 = e * rm_sum + Ra_2
    return e,V_1,V_2,V_3

#扰动数据生成
def perbed_data_generate():
    perbed_data = []
    for m in range(len(Mission)):
        perbed_data.append(Task_data_8[m] - alpha_8[m])
    return perbed_data

#主函数
def main():
    #t = time.perf_counter()
    rm,ct_1,ct_2 = FE_Encrypt_data()
    e,V_1,V_2,V_3 = ZKP_generate(rm)
    perbed_data_generate()
    #print(f'cost: {time.perf_counter() - t:.8f}s')
    return ct_1,ct_2,e,V_1,V_2,V_3
#main()